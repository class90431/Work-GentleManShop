{"remainingRequest":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/heather/Desktop/Harden/work-ecshop/src/views/Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/heather/Desktop/Harden/work-ecshop/src/views/Coupons.vue","mtime":1561023110000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// 帳號： ud11336699@gmail.com\n// 密碼： 11336699\nimport $ from 'jquery'\nexport default {\n  data () {\n    return {\n      isLoading: false,\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        percent: 100,\n        is_enabled: 0,\n        due_date: 0,\n        code: ''\n      },\n      due_date: new Date(),\n      isNew: false,\n      tempApi: '',\n      isDelete: false\n    }\n  },\n  watch: {\n    due_date () {\n      const vm = this\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000)\n      vm.tempCoupon.due_date = timestamp\n    }\n  },\n  methods: {\n    getCoupons (page = 1) {\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupons?page=${page}`\n      const vm = this\n      vm.isLoading = true\n      this.$http.get(api).then((response) => {\n        console.log(response.data)\n        vm.isLoading = false\n        vm.coupons = response.data.coupons\n        console.log(vm.coupons)\n      })\n    },\n    openModal (isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {}\n        this.isNew = true\n      } else {\n        this.tempCoupon = Object.assign({}, item)\n        this.isNew = false\n      }\n      $('#couponModal').modal('show')\n    },\n    updateCoupon () {\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon`\n      let httpMethod = 'post'\n      const vm = this\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon/${vm.tempCoupon.id}`\n        httpMethod = 'put'\n      }\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then((response) => {\n        console.log(response.data)\n        if (response.data.success) {\n          $('#couponModal').modal('hide')\n          vm.$bus.$emit('messsage:push', response.data.message, 'success') // Alert: 已建立新產品\n          vm.getCoupons()\n        } else {\n          console.log('新增失敗')\n        }\n        // vm.products = response.data.products;\n      })\n    },\n    deleteModal (item) {\n      this.tempCoupon = item\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon/${item.id}`\n      this.tempApi = api\n      this.isDelete = false\n      $('#delCouponModal').modal('show')\n    },\n    deleteCoupon () {\n      const vm = this\n      this.isDelete = true\n      if (this.isDelete) {\n        this.$http.delete(vm.tempApi).then((response) => {\n          console.log(response.data)\n          $('#delCouponModal').modal('hide')\n          this.$bus.$emit('messsage:push', response.data.message, 'danger') // Alert: 已刪除優惠券\n          vm.getCoupons()\n        })\n      }\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n",{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Coupons.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <loading :active.sync=\"isLoading\"></loading>\n    <div class=\"text-right mt-4\">\n      <button class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#exampleModal\"\n        @click=\"openModal(true)\">建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th class=\"text-left\">名稱</th>\n          <th width=\"120\">折扣百分比</th>\n          <th width=\"200\">到期日</th>\n          <th width=\"100\">是否啟用</th>\n          <th width=\"150\">編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item, index) in coupons\" :key=\"index\">\n          <td class=\"text-left\">{{ item.title }}</td>\n          <td>{{ item.percent }}%</td>\n          <td>\n            {{ item.due_date | time }}\n          </td>\n          <td>\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else class=\"text-danger\">未啟用</span>\n          </td>\n          <td>\n            <button type=\"button\" class=\"btn-sm btn btn-outline-primary\" @click.prevent=\"openModal(false,item)\">編輯</button>\n            <button type=\"button\" class=\"btn-sm btn btn-outline-danger\" @click.prevent=\"deleteModal(item)\">刪除</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <!-- Modal -->\n    <div class=\"modal fade\" id=\"couponModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">新增優惠券</h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"form-group \">\n              <label class=\"text-left\" for=\"title\">名稱</label>\n              <input type=\"text\" class=\"form-control\" id=\"title\" v-model=\"tempCoupon.title\"\n                placeholder=\"請輸入名稱\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"coupon_code\">優惠碼</label>\n              <input type=\"text\" class=\"form-control\" id=\"coupon_code\" v-model=\"tempCoupon.code\"\n                placeholder=\"請輸入優惠碼\">\n            </div>\n            <div class=\"form-group \">\n              <label for=\"percent\">折扣百分比</label>\n              <input type=\"number\" class=\"form-control\" id=\"percent\" v-model=\"tempCoupon.percent\"\n                placeholder=\"請輸入百分比\">\n            </div>\n            <div class=\"form-group \">\n              <label for=\"due_date\">到期日 </label>\n              <input type=\"date\" class=\"form-control\" id=\"due_date\"\n                v-model=\"due_date\">\n            </div>\n            <div class=\"form-group\">\n              <div class=\"form-check\">\n                <input class=\"form-check-input\" type=\"checkbox\" id=\"is_enabled\"\n                  v-model=\"tempCoupon.is_enabled\" :true-value=\"1\" :false-value=\"0\">\n                <label class=\"form-check-label\" for=\"is_enabled\">\n                  是否啟用\n                </label>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-primary\" @click=\"updateCoupon\">確認</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 刪除 Modal -->\n    <div class=\"modal fade\" id=\"delCouponModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-danger text-white\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">\n              <span>刪除優惠券</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            是否刪除 <strong class=\"text-danger\">{{ tempCoupon.title }}</strong> 優惠券(刪除後將無法恢復)。\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-danger\" @click.prevent=\"deleteCoupon\">確認刪除</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n// 帳號： ud11336699@gmail.com\n// 密碼： 11336699\nimport $ from 'jquery'\nexport default {\n  data () {\n    return {\n      isLoading: false,\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        percent: 100,\n        is_enabled: 0,\n        due_date: 0,\n        code: ''\n      },\n      due_date: new Date(),\n      isNew: false,\n      tempApi: '',\n      isDelete: false\n    }\n  },\n  watch: {\n    due_date () {\n      const vm = this\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000)\n      vm.tempCoupon.due_date = timestamp\n    }\n  },\n  methods: {\n    getCoupons (page = 1) {\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupons?page=${page}`\n      const vm = this\n      vm.isLoading = true\n      this.$http.get(api).then((response) => {\n        console.log(response.data)\n        vm.isLoading = false\n        vm.coupons = response.data.coupons\n        console.log(vm.coupons)\n      })\n    },\n    openModal (isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {}\n        this.isNew = true\n      } else {\n        this.tempCoupon = Object.assign({}, item)\n        this.isNew = false\n      }\n      $('#couponModal').modal('show')\n    },\n    updateCoupon () {\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon`\n      let httpMethod = 'post'\n      const vm = this\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon/${vm.tempCoupon.id}`\n        httpMethod = 'put'\n      }\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then((response) => {\n        console.log(response.data)\n        if (response.data.success) {\n          $('#couponModal').modal('hide')\n          vm.$bus.$emit('messsage:push', response.data.message, 'success') // Alert: 已建立新產品\n          vm.getCoupons()\n        } else {\n          console.log('新增失敗')\n        }\n        // vm.products = response.data.products;\n      })\n    },\n    deleteModal (item) {\n      this.tempCoupon = item\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/coupon/${item.id}`\n      this.tempApi = api\n      this.isDelete = false\n      $('#delCouponModal').modal('show')\n    },\n    deleteCoupon () {\n      const vm = this\n      this.isDelete = true\n      if (this.isDelete) {\n        this.$http.delete(vm.tempApi).then((response) => {\n          console.log(response.data)\n          $('#delCouponModal').modal('hide')\n          this.$bus.$emit('messsage:push', response.data.message, 'danger') // Alert: 已刪除優惠券\n          vm.getCoupons()\n        })\n      }\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n</script>\n"]}]}