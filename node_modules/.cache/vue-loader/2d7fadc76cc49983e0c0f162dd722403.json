{"remainingRequest":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/heather/Desktop/Harden/work-ecshop/src/views/ProductList.vue?vue&type=style&index=0&id=67a91b63&lang=scss&scoped=true&","dependencies":[{"path":"/Users/heather/Desktop/Harden/work-ecshop/src/views/ProductList.vue","mtime":1560149749000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/heather/Desktop/Harden/work-ecshop/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nselect {\n    // height: 20px;\n    -webkit-border-radius: 0;\n    border: 0;\n    outline: 1px solid #ccc;\n    outline-offset: -1px;\n  }\n",{"version":3,"sources":["ProductList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwRA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProductList.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <loading :active.sync=\"isLoading\"></loading>\n    <div class=\"text-right mt-4\">\n      <button class=\"btn btn-dark\" @click.prevent=\"openModal(true)\">Create a new product</button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th width=\"120\">分類</th>\n          <th>名稱</th>\n          <th width=\"120\">原價</th>\n          <th width=\"120\">售價</th>\n          <th width=\"100\">是否啟用</th>\n          <th>編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item) in products\" :key=\"item.id\">\n          <td>{{ item.category }}</td>\n          <td>{{ item.title }}</td>\n          <td class=\"text-right\">\n            {{ item.origin_price | currency }}\n          </td>\n          <td class=\"text-right\">\n            {{ item.price | currency }}\n          </td>\n          <td>\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else class=\"text-danger\">未啟用</span>\n          </td>\n          <td>\n            <button class=\"btn btn-outline-primary mr-1\"\n              @click.prevent=\"openModal(false, false, item)\">編輯</button>\n            <button class=\"btn btn-outline-danger\" @click.prevent=\"openModal(false, true, item)\">刪除</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <!-- Pagination -->\n    <Pagination :paginationComponent=\"pagination\" v-on:turnpage=\"getProducts\"></Pagination>\n    <!-- Modal for create a new product-->\n        <div class=\"modal fade\" id=\"productModal\" tabindex=\"-1\" role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n      <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-dark text-white\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">\n              <span>新增產品</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"row\">\n              <div class=\"col-sm-4\">\n                <div class=\"form-group\">\n                  <label for=\"image\">輸入圖片網址</label>\n                  <input type=\"text\" class=\"form-control\" id=\"image\"\n                    placeholder=\"請輸入圖片連結\" v-model=\"tempProduct.imageUrl\">\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"customFile\">或 上傳圖片\n                    <i class=\"fas fa-spinner fa-spin\" v-if=\"state.uploadFile == true\"></i>\n                  </label>\n                  <input type=\"file\" id=\"customFile\" class=\"form-control\"\n                    ref=\"files\" @change=\"uploadFile\">\n                </div>\n                <img class=\"img-fluid\" :src=\"tempProduct.imageUrl\" alt=\"\">\n              </div>\n              <div class=\"col-sm-8\">\n                <div class=\"form-group\">\n                  <label for=\"title\">標題</label>\n                  <input type=\"text\" class=\"form-control\" id=\"title\"\n                    placeholder=\"請輸入標題\" v-model=\"tempProduct.title\">\n                </div>\n\n                <div class=\"form-row\">\n                  <div class=\"form-group col-md-6\">\n                    <label for=\"category\">分類</label>\n                    <!-- <input type=\"text\" class=\"form-control\" id=\"category\"\n                      placeholder=\"請輸入分類\" v-model=\"tempProduct.category\"> -->\n                      <select class=\"form-control\" v-model=\"tempProduct.category\">\n                        <option>1</option>\n                        <option>2</option>\n                        <option>3</option>\n                        <option>4</option>\n                        <option>5</option>\n                      </select>\n                  </div>\n                  <div class=\"form-group col-md-6\">\n                    <label for=\"price\">單位</label>\n                    <input type=\"unit\" class=\"form-control\" id=\"unit\"\n                      placeholder=\"請輸入單位\" v-model=\"tempProduct.unit\">\n                  </div>\n                </div>\n\n                <div class=\"form-row\">\n                  <div class=\"form-group col-md-6\">\n                  <label for=\"origin_price\">原價</label>\n                    <input type=\"number\" class=\"form-control\" id=\"origin_price\"\n                      placeholder=\"請輸入原價\" v-model=\"tempProduct.origin_price\">\n                  </div>\n                  <div class=\"form-group col-md-6\">\n                    <label for=\"price\">售價</label>\n                    <input type=\"number\" class=\"form-control\" id=\"price\"\n                      placeholder=\"請輸入售價\" v-model=\"tempProduct.price\">\n                  </div>\n                </div>\n                <hr>\n\n                <div class=\"form-group\">\n                  <label for=\"description\">產品描述</label>\n                  <textarea type=\"text\" class=\"form-control\" id=\"description\"\n                    placeholder=\"請輸入產品描述\" v-model=\"tempProduct.description\"></textarea>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"content\">說明內容</label>\n                  <textarea type=\"text\" class=\"form-control\" id=\"content\"\n                    placeholder=\"請輸入產品說明內容\" v-model=\"tempProduct.content\"></textarea>\n                </div>\n                <div class=\"form-group\">\n                  <div class=\"form-check\">\n                    <input class=\"form-check-input\" type=\"checkbox\"\n                      id=\"is_enabled\" v-model=\"tempProduct.is_enabled\" :true-value=\"1\" :false-value=\"0\">\n                    <label class=\"form-check-label\" for=\"is_enabled\">\n                      是否啟用\n                    </label>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-primary\" @click.prevent=\"updateProduct\">確認</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- Modal for makesure to delete the product-->\n    <div class=\"modal fade\" id=\"delProductModal\" tabindex=\"-1\" role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-danger text-white\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">\n              <span>刪除產品</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            是否刪除 <strong class=\"text-danger\">{{ tempProduct.title }}</strong> 商品(刪除後將無法恢復)。\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-danger\" @click.prevent=\"updateProduct\">確認刪除</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport $ from 'jquery' // 載入 jQuery\nimport Pagination from '../components/Pagination'\nexport default {\n  data () {\n    return {\n      products: [],\n      tempProduct: {},\n      pagination: {},\n      isNew: false,\n      isDelete: false,\n      isLoading: false,\n      state: {\n        uploadFile: false\n      }\n    }\n  },\n  methods: {\n    getProducts (page = 1) {\n      const api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/products?page=${page}`\n      const vm = this\n      vm.isLoading = true\n      this.$http.get(api).then((response) => {\n        console.log(response.data)\n        vm.products = response.data.products\n        vm.isLoading = false\n        console.log(vm.products)\n        vm.pagination = response.data.pagination\n        console.log(vm.pagination)\n      })\n    },\n    openModal (isNew, isDelete, item) {\n      if (!isDelete) { // 判斷開啟哪個 Modal(編輯 or 刪除), !isDelete 是編輯。\n        if (isNew) { // 判斷是否為新的產品。如果 isNew = true 代表是新產品; 如果 isNew = false 代表是要編輯產品\n          this.tempProduct = {}\n          this.isNew = true\n        } else {\n          //  this.tempProduct = item 物件傳參考的特性，如果這樣寫則 item 會複寫 tempProduct\n          this.tempProduct = Object.assign({}, item) // Object.assign 是 ES6 的方法：https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n          this.isNew = false\n        }\n        $('#productModal').modal('show') // 打開 Modal\n      } else { // isDelete = true\n        $('#delProductModal').modal('show')\n        this.tempProduct = Object.assign({}, item)\n        this.isDelete = true\n      }\n    },\n    updateProduct () {\n      // httpMethod = 'post', 'put', 'delete' 分別代表 '新增', '編輯', '刪除'\n      let api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/product`\n      let httpMethod = 'post'\n      const vm = this\n      // console.log(vm.isNew, vm.isDelete)\n      if (!vm.isNew && !vm.isDelete) { // 判斷是已有的產品 且 沒有要刪除，則更改 api 以及 ’方法(httpMethod)‘\n        api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/product/${vm.tempProduct.id}`\n        httpMethod = 'put'\n      } else if (!vm.isNew && vm.isDelete) { // 判斷是已有的產品 且 要刪除，則更改 api 以及 ’方法(httpMethod)‘\n        api = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/product/${vm.tempProduct.id}`\n        httpMethod = 'delete'\n        vm.isDelete = false\n      }\n      this.$http[httpMethod](api, { data: vm.tempProduct }).then((response) => {\n        console.log(response.data)\n        if (response.data) {\n          $('#productModal').modal('hide')\n          $('#delProductModal').modal('hide')\n          vm.getProducts()\n        } else {\n          $('#productModal').modal('hide')\n          console.log('失敗')\n        }\n      })\n    },\n    uploadFile () { // 上傳照片\n      // console.log(this)\n      const uploadedFile = this.$refs.files.files[0] // 此為照片檔案，可用 console.log(uploadedFile) 看\n      // console.log(uploadedFile)\n      const vm = this\n      vm.state.uploadFile = true\n      const formData = new FormData() // 參考：https://developer.mozilla.org/zh-TW/docs/Web/API/FormData\n      formData.append('file-to-upload', uploadedFile)\n      const url = `${process.env.VUE_APP_API_PATH}/api/${process.env.VUE_APP_CUSTOMER_PATH}/admin/upload`\n      this.$http.post(url, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then((response) => {\n        console.log(response.data)\n        if (response.data.success) {\n          // vm.tempProduct.imageUrl = response.data.imageUrl\n          // console.log(vm.tempProduct.imageUrl)\n          // console.log(vm.tempProduct)\n          vm.$set(vm.tempProduct, 'imageUrl', response.data.imageUrl) // 因為無事先定義部分變數，所以用 $set 強制綁定\n          this.$bus.$emit('messsage:push', '上傳成功', 'success')\n          vm.state.uploadFile = false\n        } else {\n          console.log(response.data.message)\n          this.$bus.$emit('messsage:push', response.data.message, 'warning')\n          vm.state.uploadFile = false\n        }\n      })\n    }\n  },\n  components: {\n    Pagination\n  },\n  created () {\n    this.getProducts()\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\nselect {\n    // height: 20px;\n    -webkit-border-radius: 0;\n    border: 0;\n    outline: 1px solid #ccc;\n    outline-offset: -1px;\n  }\n</style>\n"]}]}